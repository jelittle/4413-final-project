

services:
  reverse-proxy:
    build: ./nginx
    # image: nginx-proxy
    ports:
      - 8080:80
    depends_on:
      - catalogue
      - payment
      - users

  catalogue:
    build: ./CatalogueService
    image: catalogue-service
    container_name: catalogue-service

  analytics:
    build: ./Analytics
    image: analytics-service
    container_name: analytics-service

  payment:
    build: ./PaymentService
    image: payment-service
    container_name: payment-service

  users:
    build: ./UserService
    image: user-service
    container_name: user-service

  mongo-container:
    image: mongo:latest
    ports:
      - 27017:27017
    volumes:
      - catalogue_volume:/data/db

  db:
    image: mysql:8.4.0
    # restart: always
    volumes:
      - ./db/mysql_data:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: asdasd
    ports: 
      - 3306:3306
  phpmyadmin:
    depends_on:
      - db
    image: phpmyadmin/phpmyadmin:5.2.1
    # restart: always
    ports:
      - 8081:80
    volumes:
      - ./db/phpMyAdmin-new:/var/www/html
    environment:
      PMA_HOST: db
      MYSQL_ROOT_PASSWORD: asdasd
      UPLOAD_LIMIT: 1G
      PHP_UPLOAD_MAX_FILESIZE: 1G
      PHP_POST_MAX_SIZE: 1G

volumes:
  catalogue_volume:
  sqlserverdata: